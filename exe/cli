#!/usr/bin/env ruby
# frozen_string_literal: true

$LOAD_PATH.unshift "#{File.dirname(__FILE__)}/../lib"

require 'inkstats'
require 'thor'

class Cli < Thor
  desc 'init', 'Create schema'
  def init
    storage.create_schema!
  end

  desc 'upload', 'Upload latest games'
  def upload
    data = extractor.fetch_battles
    data = JSON.parse File.read('spec/data/battles.json')
    battles = parser.parse data
    # inserted = storage.save battles

    puts "[+] Inserted #{inserted} battles"
  end

  no_commands do
    def storage
      Inkstats::Storage.new
    end

    def parser
      Inkstats::Parser.new
    end

    def extractor
      Inkstats::Extractor.new 'bf8f7fb17733e383f7526382acb3dcc6bf4b7053'
    end
  end
end

Cli.start ARGV
